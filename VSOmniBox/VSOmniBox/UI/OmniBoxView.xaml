<Window x:Class="VSOmniBox.UI.OmniBoxView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:ui="clr-namespace:VSOmniBox.UI"
        xmlns:uicolors="clr-namespace:VSOmniBox.UI.Colors"
        mc:Ignorable="d" 
        AllowsTransparency="True"
        Background="Transparent"
        FocusManager.FocusedElement="{Binding ElementName=SearchTextBox}"
        ResizeMode="NoResize"
        ShowInTaskbar="False"
        SizeToContent="Height"
        Width="400"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None">
    <Window.Resources>

        <!-- Search box item template styles our results list. -->
        <DataTemplate x:Key="SearchBoxDataTemplate">
            <StackPanel>
                <TextBlock x:Name="TitleBlock" FontSize="18" Text="{Binding Path=Title}" Margin="20,0,0,0"/>
                <TextBlock x:Name="DescriptionBlock" FontSize="14" Text="{Binding Path=Description}" FontStyle="Italic" Margin="25,0,0,0" ToolTip="{Binding Path=Description}"/>
            </StackPanel>

            <DataTemplate.Triggers>

                <!-- Null description, hide the description block. -->
                <DataTrigger Binding="{Binding Description}" Value="">
                    <Setter TargetName="DescriptionBlock" Property="Visibility" Value="Collapsed" />
                </DataTrigger>
                
                <!-- Empty description, hide the description block. -->
                <DataTrigger Binding="{Binding Description}" Value="{x:Null}">
                    <Setter TargetName="DescriptionBlock" Property="Visibility" Value="Collapsed" />
                </DataTrigger>

                <!-- Pivot items are special emphasized results that are used to group items. -->
                <DataTrigger Binding="{Binding IsPivot}" Value="True">
                    <Setter TargetName="TitleBlock" Property="Margin" Value="0" />
                    <Setter TargetName="DescriptionBlock" Property="Visibility" Value="Collapsed" />
                    <Setter Property="TextBlock.FontSize" Value="20" />
                    <Setter Property="TextBlock.FontWeight" Value="Bold" />
                </DataTrigger>
            </DataTemplate.Triggers>
        </DataTemplate>

        <Style x:Key="PopupBorderStyle" TargetType="{x:Type Border}">
            <Setter Property="BorderThickness" Value="1.0" />
            <!-- TODO: use something other than the text brush here. -->
            <Setter Property="BorderBrush" Value="{DynamicResource {x:Static uicolors:VSColors.PopupBackgroundTextBrushKey}}" />
            <Setter Property="Background" Value="{DynamicResource {x:Static uicolors:VSColors.PopupBackgroundBrushKey}}" />
            <Setter Property="CornerRadius" Value="5" />
        </Style>

        <Style TargetType="{x:Type TextBox}">
            <!-- TODO: use something other than the text brush here. -->
            <Setter Property="Background" Value="{DynamicResource {x:Static uicolors:VSColors.PopupBackgroundTextBrushKey}}" />
            <Setter Property="Margin" Value="5" />
            <Setter Property="FontSize" Value="30" />
        </Style>

        <Style TargetType="{x:Type ListBox}">
            <!-- TODO: use something other than the text brush here. -->
            <Setter Property="Background" Value="{DynamicResource {x:Static uicolors:VSColors.PopupBackgroundTextBrushKey}}" />
            <Setter Property="Focusable" Value="False" />
            <Setter Property="ItemTemplate" Value="{StaticResource SearchBoxDataTemplate}" />
            <Setter Property="Margin" Value="5" />
            <Setter Property="Margin" Value="5,0,5,5" />
            <Setter Property="MaxHeight" Value="200" />
            <Setter Property="MinHeight" Value="0" />
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Hidden" />
            <Setter Property="Visibility" Value="Collapsed" />
            <Style.Triggers>
                <Trigger Property="ItemsControl.HasItems" Value="True">
                    <Setter Property="Visibility" Value="Visible" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Window.InputBindings>
        <KeyBinding Command="{Binding DismissCommand}" Key="Esc"/>
    </Window.InputBindings>

    <Window.Content>
        <Border Style="{StaticResource PopupBorderStyle}">
            <DockPanel LastChildFill="True">
                <TextBox Name="SearchTextBox"
                         DockPanel.Dock="Top"
                         Text="{Binding SearchString, UpdateSourceTrigger=PropertyChanged}">
                    <TextBox.InputBindings>
                        <KeyBinding Command="{Binding DownCommand}" Key="Down" />
                        <KeyBinding Command="{Binding DismissCommand}" Key="Esc" />
                        <KeyBinding Command="{Binding InvokeCommand}" Key="Return" />
                        <KeyBinding Command="{Binding UpCommand}" Key="Up" />
                    </TextBox.InputBindings>
                </TextBox>
                <ListBox x:Name="ResultsBox"
                         DockPanel.Dock="Bottom"
                         ItemsSource="{Binding SearchResults}"
                         SelectedIndex="{Binding SelectedItemIndex}" />
            </DockPanel>
        </Border>
    </Window.Content>
</Window>
